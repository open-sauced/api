<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@open-sauced/api documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">@open-sauced/api documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >UserService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/user/services/user.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#applyCoupon" >applyCoupon</a>
                            </li>
                            <li>
                                <a href="#baseQueryBuilder" >baseQueryBuilder</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#checkAddUser" >checkAddUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#deleteUser" >deleteUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findManyByUsernames" >findManyByUsernames</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOneByEmail" >findOneByEmail</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOneById" >findOneById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findOneByUsername" >findOneByUsername</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findTopUsers" >findTopUsers</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findUsersByFilter" >findUsersByFilter</a>
                            </li>
                            <li>
                                <a href="#reactionsQueryBuilder" >reactionsQueryBuilder</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateEmailPreferences" >updateEmailPreferences</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateInterests" >updateInterests</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateOnboarding" >updateOnboarding</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateRole" >updateRole</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateUser" >updateUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateWaitlistStatus" >updateWaitlistStatus</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(userRepository: <a href="../entitys/DbUser.html" target="_self">Repository&lt;DbUser&gt;</a>, userHighlightReactionRepository: <a href="../s/User.html" target="_self">Repository&lt;DbUserHighlightReaction&gt;</a>, userHighlightRepository: <a href="../s/User.html" target="_self">Repository&lt;DbUserHighlight&gt;</a>, userInsightsRepository: <a href="../entitys/DbInsight.html" target="_self">Repository&lt;DbInsight&gt;</a>, userCollaborationRepository: <a href="../s/User.html" target="_self">Repository&lt;DbUserCollaboration&gt;</a>, userListRepository: <a href="../s/User.html" target="_self">Repository&lt;DbUserList&gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/user/services/user.service.ts:25</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>userRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/DbUser.html" target="_self" >Repository&lt;DbUser&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userHighlightReactionRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/variables.html#User" target="_self" >Repository&lt;DbUserHighlightReaction&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userHighlightRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/variables.html#User" target="_self" >Repository&lt;DbUserHighlight&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userInsightsRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/DbInsight.html" target="_self" >Repository&lt;DbInsight&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userCollaborationRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/variables.html#User" target="_self" >Repository&lt;DbUserCollaboration&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userListRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../miscellaneous/variables.html#User" target="_self" >Repository&lt;DbUserList&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="applyCoupon"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>applyCoupon</b></span>
                        <a href="#applyCoupon"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>applyCoupon(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, coupon: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="353"
                            class="link-to-prism">src/user/services/user.service.ts:353</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>coupon</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="baseQueryBuilder"></a>
                    <span class="name">
                        <span ><b>baseQueryBuilder</b></span>
                        <a href="#baseQueryBuilder"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>baseQueryBuilder()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="41"
                            class="link-to-prism">src/user/services/user.service.ts:41</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/DbUser.html" target="_self" >SelectQueryBuilder&lt;DbUser&gt;</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkAddUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>checkAddUser</b></span>
                        <a href="#checkAddUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkAddUser(user: <a href="../s/User.html" target="_self">User</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="245"
                            class="link-to-prism">src/user/services/user.service.ts:245</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../miscellaneous/variables.html#User" target="_self" >User</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/DbUser.html" target="_self" >Promise&lt;DbUser&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>deleteUser</b></span>
                        <a href="#deleteUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteUser(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="377"
                            class="link-to-prism">src/user/services/user.service.ts:377</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findManyByUsernames"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findManyByUsernames</b></span>
                        <a href="#findManyByUsernames"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findManyByUsernames(usernames: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="202"
                            class="link-to-prism">src/user/services/user.service.ts:202</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>usernames</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/DbUser.html" target="_self" >Promise&lt;DbUser[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOneByEmail"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOneByEmail</b></span>
                        <a href="#findOneByEmail"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOneByEmail(email: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="360"
                            class="link-to-prism">src/user/services/user.service.ts:360</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>email</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/DbUser.html" target="_self" >Promise&lt;DbUser | null&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOneById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOneById</b></span>
                        <a href="#findOneById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOneById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, includeEmail)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="83"
                            class="link-to-prism">src/user/services/user.service.ts:83</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>includeEmail</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/DbUser.html" target="_self" >Promise&lt;DbUser&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findOneByUsername"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findOneByUsername</b></span>
                        <a href="#findOneByUsername"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findOneByUsername(username: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="128"
                            class="link-to-prism">src/user/services/user.service.ts:128</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>username</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/DbUser.html" target="_self" >Promise&lt;DbUser&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findTopUsers"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findTopUsers</b></span>
                        <a href="#findTopUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findTopUsers(pageOptionsDto: <a href="../classes/TopUsersDto.html" target="_self">TopUsersDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="53"
                            class="link-to-prism">src/user/services/user.service.ts:53</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>pageOptionsDto</td>
                                    <td>
                                                <code><a href="../classes/TopUsersDto.html" target="_self" >TopUsersDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/variables.html#User" target="_self" >Promise&lt;PageDto&lt;DbTopUser&gt;&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findUsersByFilter"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>findUsersByFilter</b></span>
                        <a href="#findUsersByFilter"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findUsersByFilter(pageOptionsDto: <a href="../classes/FilteredUsersDto.html" target="_self">FilteredUsersDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="222"
                            class="link-to-prism">src/user/services/user.service.ts:222</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>pageOptionsDto</td>
                                    <td>
                                                <code><a href="../classes/FilteredUsersDto.html" target="_self" >FilteredUsersDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/variables.html#User" target="_self" >Promise&lt;PageDto&lt;DbFilteredUser&gt;&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="reactionsQueryBuilder"></a>
                    <span class="name">
                        <span ><b>reactionsQueryBuilder</b></span>
                        <a href="#reactionsQueryBuilder"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>reactionsQueryBuilder()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="47"
                            class="link-to-prism">src/user/services/user.service.ts:47</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/variables.html#User" target="_self" >SelectQueryBuilder&lt;DbUserHighlightReaction&gt;</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateEmailPreferences"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateEmailPreferences</b></span>
                        <a href="#updateEmailPreferences"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateEmailPreferences(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, user: <a href="../classes/UpdateUserEmailPreferencesDto.html" target="_self">UpdateUserEmailPreferencesDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="346"
                            class="link-to-prism">src/user/services/user.service.ts:346</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/UpdateUserEmailPreferencesDto.html" target="_self" >UpdateUserEmailPreferencesDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateInterests"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateInterests</b></span>
                        <a href="#updateInterests"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateInterests(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, user: <a href="../classes/UpdateUserProfileInterestsDto.html" target="_self">UpdateUserProfileInterestsDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="342"
                            class="link-to-prism">src/user/services/user.service.ts:342</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/UpdateUserProfileInterestsDto.html" target="_self" >UpdateUserProfileInterestsDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateOnboarding"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateOnboarding</b></span>
                        <a href="#updateOnboarding"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateOnboarding(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, user: <a href="../classes/UserOnboardingDto.html" target="_self">UserOnboardingDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="307"
                            class="link-to-prism">src/user/services/user.service.ts:307</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/UserOnboardingDto.html" target="_self" >UserOnboardingDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateRole"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateRole</b></span>
                        <a href="#updateRole"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateRole(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, role: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="332"
                            class="link-to-prism">src/user/services/user.service.ts:332</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>role</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateUser</b></span>
                        <a href="#updateUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateUser(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, user: <a href="../classes/UpdateUserDto.html" target="_self">UpdateUserDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="282"
                            class="link-to-prism">src/user/services/user.service.ts:282</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/UpdateUserDto.html" target="_self" >UpdateUserDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateWaitlistStatus"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateWaitlistStatus</b></span>
                        <a href="#updateWaitlistStatus"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateWaitlistStatus(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="322"
                            class="link-to-prism">src/user/services/user.service.ts:322</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { BadRequestException, Injectable, NotFoundException } from &quot;@nestjs/common&quot;;
import { Repository, SelectQueryBuilder } from &quot;typeorm&quot;;
import { InjectRepository } from &quot;@nestjs/typeorm&quot;;
import { User } from &quot;@supabase/supabase-js&quot;;

import { DbUser } from &quot;../user.entity&quot;;
import { UpdateUserDto } from &quot;../dtos/update-user.dto&quot;;
import { UpdateUserProfileInterestsDto } from &quot;../dtos/update-user-interests.dto&quot;;
import { UpdateUserEmailPreferencesDto } from &quot;../dtos/update-user-email-prefs.dto&quot;;
import { UserOnboardingDto } from &quot;../../auth/dtos/user-onboarding.dto&quot;;
import { userNotificationTypes } from &quot;../entities/user-notification.constants&quot;;
import { DbUserHighlightReaction } from &quot;../entities/user-highlight-reaction.entity&quot;;
import { DbTopUser } from &quot;../entities/top-users.entity&quot;;
import { TopUsersDto } from &quot;../dtos/top-users.dto&quot;;
import { PageDto } from &quot;../../common/dtos/page.dto&quot;;
import { PageMetaDto } from &quot;../../common/dtos/page-meta.dto&quot;;
import { DbFilteredUser } from &quot;../entities/filtered-users.entity&quot;;
import { FilteredUsersDto } from &quot;../dtos/filtered-users.dto&quot;;
import { DbUserHighlight } from &quot;../entities/user-highlight.entity&quot;;
import { DbInsight } from &quot;../../insight/entities/insight.entity&quot;;
import { DbUserCollaboration } from &quot;../entities/user-collaboration.entity&quot;;
import { DbUserList } from &quot;../../user-lists/entities/user-list.entity&quot;;

@Injectable()
export class UserService {
  constructor(
    @InjectRepository(DbUser, &quot;ApiConnection&quot;)
    private userRepository: Repository&lt;DbUser&gt;,
    @InjectRepository(DbUserHighlightReaction, &quot;ApiConnection&quot;)
    private userHighlightReactionRepository: Repository&lt;DbUserHighlightReaction&gt;,
    @InjectRepository(DbUserHighlight, &quot;ApiConnection&quot;)
    private userHighlightRepository: Repository&lt;DbUserHighlight&gt;,
    @InjectRepository(DbInsight, &quot;ApiConnection&quot;)
    private userInsightsRepository: Repository&lt;DbInsight&gt;,
    @InjectRepository(DbUserCollaboration, &quot;ApiConnection&quot;)
    private userCollaborationRepository: Repository&lt;DbUserCollaboration&gt;,
    @InjectRepository(DbUserList, &quot;ApiConnection&quot;)
    private userListRepository: Repository&lt;DbUserList&gt;
  ) {}

  baseQueryBuilder(): SelectQueryBuilder&lt;DbUser&gt; {
    const builder &#x3D; this.userRepository.createQueryBuilder(&quot;users&quot;);

    return builder;
  }

  reactionsQueryBuilder(): SelectQueryBuilder&lt;DbUserHighlightReaction&gt; {
    const builder &#x3D; this.userHighlightReactionRepository.createQueryBuilder(&quot;user_highlight_reactions&quot;);

    return builder;
  }

  async findTopUsers(pageOptionsDto: TopUsersDto): Promise&lt;PageDto&lt;DbTopUser&gt;&gt; {
    const queryBuilder &#x3D; this.reactionsQueryBuilder();

    const { userId } &#x3D; pageOptionsDto;

    queryBuilder
      .select(&quot;users.login as login&quot;)
      .from(DbUser, &quot;users&quot;)
      .innerJoin(&quot;user_highlights&quot;, &quot;user_highlights&quot;, &quot;user_highlights.user_id &#x3D; users.id&quot;)
      .innerJoin(&quot;user_highlight_reactions&quot;, &quot;reactions&quot;, &quot;reactions.highlight_id &#x3D; user_highlights.id&quot;)
      .where(&quot;reactions.deleted_at IS NULL&quot;);

    if (userId) {
      queryBuilder
        .andWhere(
          &quot;users.id NOT IN (SELECT following_user_id FROM users_to_users_followers WHERE user_id &#x3D; :userId AND deleted_at IS NULL)&quot;
        )
        .setParameters({ userId });
    }

    queryBuilder.groupBy(&quot;users.login&quot;).orderBy(&quot;COUNT(reactions.user_id)&quot;, &quot;DESC&quot;);

    queryBuilder.offset(pageOptionsDto.skip).limit(pageOptionsDto.limit);

    const [itemCount, entities] &#x3D; await Promise.all([queryBuilder.getCount(), queryBuilder.getRawMany()]);
    const pageMetaDto &#x3D; new PageMetaDto({ itemCount, pageOptionsDto });

    return new PageDto(entities, pageMetaDto);
  }

  async findOneById(id: number, includeEmail &#x3D; false): Promise&lt;DbUser&gt; {
    const queryBuilder &#x3D; this.baseQueryBuilder();

    queryBuilder
      .addSelect(
        &#x60;(
          SELECT COALESCE(COUNT(&quot;user_notifications&quot;.&quot;id&quot;), 0)
          FROM user_notifications
          WHERE user_id &#x3D; :userId
          AND user_notifications.type IN (:...userNotificationTypes)
          AND user_notifications.read_at IS NULL
        )::INTEGER&#x60;,
        &quot;users_notification_count&quot;
      )
      .addSelect(
        &#x60;(
          SELECT COALESCE(COUNT(&quot;insights&quot;.&quot;id&quot;), 0)
          FROM insights
          WHERE user_id &#x3D; :userId
        )::INTEGER&#x60;,
        &quot;users_insights_count&quot;
      )
      .where(&quot;id &#x3D; :id&quot;, { id });

    if (includeEmail) {
      queryBuilder.addSelect(&quot;users.email&quot;, &quot;users_email&quot;);
    }

    let item: DbUser | null;

    try {
      queryBuilder.setParameters({ userId: id, userNotificationTypes });
      item &#x3D; await queryBuilder.getOne();
    } catch (e) {
      // handle error
      item &#x3D; null;
    }

    if (!item) {
      throw new NotFoundException();
    }

    return item;
  }

  async findOneByUsername(username: string): Promise&lt;DbUser&gt; {
    const queryBuilder &#x3D; this.baseQueryBuilder();

    queryBuilder
      .addSelect(
        &#x60;(
        SELECT COALESCE(COUNT(&quot;user_highlights&quot;.&quot;id&quot;), 0)
        FROM user_highlights
        WHERE user_id &#x3D; users.id
        AND user_highlights.deleted_at IS NULL
      )::INTEGER&#x60;,
        &quot;users_highlights_count&quot;
      )
      .addSelect(
        &#x60;(
        SELECT COALESCE(COUNT(&quot;user_follows&quot;.&quot;id&quot;), 0)
        FROM users_to_users_followers user_follows
        WHERE user_id &#x3D; users.id
        AND user_follows.deleted_at IS NULL
      )::INTEGER&#x60;,
        &quot;users_following_count&quot;
      )
      .addSelect(
        &#x60;(
        SELECT COALESCE(COUNT(&quot;user_follows&quot;.&quot;id&quot;), 0)
        FROM users_to_users_followers user_follows
        WHERE following_user_id &#x3D; users.id
        AND user_follows.deleted_at IS NULL
      )::INTEGER&#x60;,
        &quot;users_followers_count&quot;
      )
      .addSelect(
        &#x60;(
        SELECT COALESCE(COUNT(&quot;pull_requests&quot;.&quot;id&quot;), 0)
        FROM pull_requests
        WHERE LOWER(author_login) &#x3D; :username
        AND now() - INTERVAL &#x27;30 days&#x27; &lt;&#x3D; &quot;pull_requests&quot;.&quot;updated_at&quot;
      )::INTEGER&#x60;,
        &quot;users_recent_pull_requests_count&quot;
      )
      .addSelect(
        &#x60;(
          SELECT COALESCE(AVG((&quot;pull_requests&quot;.&quot;merged_at&quot;::DATE - &quot;pull_requests&quot;.&quot;created_at&quot;::DATE)), 0)
          FROM &quot;pull_requests&quot;
          WHERE LOWER(&quot;pull_requests&quot;.&quot;author_login&quot;) &#x3D; :username
          AND now() - INTERVAL &#x27;30 days&#x27; &lt;&#x3D; &quot;pull_requests&quot;.&quot;updated_at&quot;
        )::INTEGER&#x60;,
        &#x60;users_recent_pull_request_velocity_count&#x60;
      )
      .addSelect(
        &#x60;(
          SELECT
            CASE
              WHEN COUNT(DISTINCT full_name) &gt; 0 THEN true
              ELSE false
            END
          FROM pull_requests prs
          JOIN repos on prs.repo_id&#x3D;repos.id
          WHERE LOWER(prs.merged_by_login) &#x3D; :username
        )::BOOLEAN&#x60;,
        &quot;users_is_maintainer&quot;
      )
      .where(&quot;LOWER(login) &#x3D; :username&quot;, { username: username.toLowerCase() })
      .setParameters({ username: username.toLowerCase() });

    const item: DbUser | null &#x3D; await queryBuilder.getOne();

    if (!item) {
      throw new NotFoundException();
    }

    return item;
  }

  async findManyByUsernames(usernames: string[]): Promise&lt;DbUser[]&gt; {
    const queryBuilder &#x3D; this.baseQueryBuilder();
    const lowerCaseUsernames &#x3D; usernames.map((username) &#x3D;&gt; username.toLowerCase());

    queryBuilder
      .where(&quot;LOWER(login) IN (:...usernames)&quot;, { usernames: lowerCaseUsernames })
      .setParameters({ usernames: lowerCaseUsernames });

    const items: DbUser[] &#x3D; await queryBuilder.getMany();

    const foundUsernames &#x3D; items.map((user) &#x3D;&gt; user.login.toLowerCase());
    const notFoundUsernames &#x3D; lowerCaseUsernames.filter((username) &#x3D;&gt; !foundUsernames.includes(username));

    if (notFoundUsernames.length &gt; 0) {
      throw new NotFoundException(notFoundUsernames);
    }

    return items;
  }

  async findUsersByFilter(pageOptionsDto: FilteredUsersDto): Promise&lt;PageDto&lt;DbFilteredUser&gt;&gt; {
    const queryBuilder &#x3D; this.baseQueryBuilder();

    const { username, limit } &#x3D; pageOptionsDto;

    if (!username) {
      throw new BadRequestException();
    }

    queryBuilder
      .select([&quot;users.login as login&quot;, &quot;users.name as full_name&quot;])
      .where(&#x60;LOWER(users.login) LIKE :username&#x60;)
      .setParameters({ username: &#x60;%${username.toLowerCase()}%&#x60; })
      .limit(limit);

    queryBuilder.offset(pageOptionsDto.skip).limit(pageOptionsDto.limit);

    const [itemCount, entities] &#x3D; await Promise.all([queryBuilder.getCount(), queryBuilder.getRawMany()]);
    const pageMetaDto &#x3D; new PageMetaDto({ itemCount, pageOptionsDto });

    return new PageDto(entities, pageMetaDto);
  }

  async checkAddUser(user: User): Promise&lt;DbUser&gt; {
    const {
      user_metadata: { user_name, email, name },
      identities,
      confirmed_at,
    } &#x3D; user;
    const github &#x3D; identities!.filter((identity) &#x3D;&gt; identity.provider &#x3D;&#x3D;&#x3D; &quot;github&quot;)[0];
    const id &#x3D; parseInt(github.id, 10);

    try {
      const user &#x3D; await this.findOneById(id, true);

      if (!user.is_open_sauced_member) {
        await this.userRepository.update(user.id, {
          is_open_sauced_member: true,
          connected_at: new Date(),
        });
      }

      return user;
    } catch (e) {
      // create new user
      const newUser &#x3D; await this.userRepository.save({
        id,
        name: name as string,
        is_open_sauced_member: true,
        login: user_name as string,
        email: email as string,
        created_at: new Date(github.created_at),
        updated_at: new Date(github.updated_at ?? github.created_at),
        connected_at: confirmed_at ? new Date(confirmed_at) : new Date(),
      });

      return newUser;
    }
  }

  async updateUser(id: number, user: UpdateUserDto) {
    try {
      await this.findOneById(id);

      await this.userRepository.update(id, {
        name: user.name,
        email: user.email,
        bio: user.bio ?? &quot;&quot;,
        url: user.url ?? &quot;&quot;,
        twitter_username: user.twitter_username ?? &quot;&quot;,
        company: user.company ?? &quot;&quot;,
        location: user.location ?? &quot;&quot;,
        display_local_time: !!user.display_local_time,
        timezone: user.timezone,
        github_sponsors_url: user.github_sponsors_url ?? &quot;&quot;,
        linkedin_url: user.linkedin_url ?? &quot;&quot;,
        discord_url: user.discord_url ?? &quot;&quot;,
      });

      return this.findOneById(id);
    } catch (e) {
      throw new NotFoundException(&quot;Unable to update user&quot;);
    }
  }

  async updateOnboarding(id: number, user: UserOnboardingDto) {
    try {
      await this.findOneById(id);

      await this.userRepository.update(id, {
        is_onboarded: true,
        is_waitlisted: false,
        timezone: user.timezone,
        interests: user.interests.join(&quot;,&quot;),
      });
    } catch (e) {
      throw new NotFoundException(&quot;Unable to update user onboarding status&quot;);
    }
  }

  async updateWaitlistStatus(id: number) {
    try {
      await this.findOneById(id);

      await this.userRepository.update(id, { is_waitlisted: true });
    } catch (e) {
      throw new NotFoundException(&quot;Unable to update user waitlist status&quot;);
    }
  }

  async updateRole(id: number, role: number) {
    try {
      await this.findOneById(id);

      await this.userRepository.update(id, { role });
    } catch (e) {
      throw new NotFoundException(&quot;Unable to update user role&quot;);
    }
  }

  async updateInterests(id: number, user: UpdateUserProfileInterestsDto) {
    return this.userRepository.update(id, { interests: user.interests.join(&quot;,&quot;) });
  }

  async updateEmailPreferences(id: number, user: UpdateUserEmailPreferencesDto) {
    return this.userRepository.update(id, {
      display_email: user.display_email,
      receive_collaboration: user.receive_collaboration,
    });
  }

  async applyCoupon(id: number, coupon: string) {
    return this.userRepository.update(id, {
      coupon_code: coupon,
      role: 50,
    });
  }

  async findOneByEmail(email: string): Promise&lt;DbUser | null&gt; {
    const queryBuilder &#x3D; this.baseQueryBuilder();

    queryBuilder.where(&#x60;users.email &#x3D; :email&#x60;, { email: email.toLowerCase() });

    let item: DbUser | null;

    try {
      item &#x3D; await queryBuilder.getOne();
    } catch (e) {
      // handle error
      item &#x3D; null;
    }

    return item;
  }

  async deleteUser(id: number) {
    try {
      const user &#x3D; await this.findOneById(id);

      /*
       * typeORM doesn&#x27;t play well with soft deletes and foreign key constraints.
       * so, we capture all the users&#x27;s relations and soft delete them manually
       * without disrupting the foreign key constraint back to the user
       */
      const userAndRelations &#x3D; await this.userRepository.findOneOrFail({
        where: {
          id,
        },
        relations: [
          &quot;highlights&quot;,
          &quot;insights&quot;,
          &quot;collaborations&quot;,
          &quot;request_collaborations&quot;,
          &quot;from_user_notifications&quot;,
          &quot;lists&quot;,
        ],
      });

      await this.userRepository.softDelete(id);

      // need to reset these as we&#x27;re only doing a soft delete.
      await this.userRepository.update(id, {
        is_onboarded: false,
        is_open_sauced_member: false,
      });

      await Promise.all([
        // soft delete the user&#x27;s highlights
        Promise.all(
          userAndRelations.highlights.map(async (highlight) &#x3D;&gt; {
            await this.userHighlightRepository.softDelete(highlight.id);
          })
        ),

        // soft delete the user&#x27;s insight pages
        Promise.all(
          userAndRelations.insights.map(async (insight) &#x3D;&gt; {
            await this.userInsightsRepository.softDelete(insight.id);
          })
        ),

        // soft delete the user&#x27;s collaborations
        Promise.all(
          userAndRelations.collaborations.map(async (collab) &#x3D;&gt; {
            await this.userCollaborationRepository.softDelete(collab.id);
          })
        ),
        // soft delete the user&#x27;s collaboration requests
        Promise.all(
          userAndRelations.request_collaborations.map(async (req_collab) &#x3D;&gt; {
            await this.userCollaborationRepository.softDelete(req_collab.id);
          })
        ),

        // soft delete the user&#x27;s lists
        Promise.all(
          userAndRelations.lists.map(async (list) &#x3D;&gt; {
            await this.userListRepository.softDelete(list.id);
          })
        ),
      ]);

      return user;
    } catch (e) {
      throw new NotFoundException(&quot;Unable to delete user&quot;);
    }
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'UserService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
